## Training a Span Classifier with Spacy

### Training Data
First we need to prepare the training data in a spacy readble format. This is done in the `./training/preprocess.py` python script.

### Training
In order to train a classifier we can use the spacy cli:
```bash
python -m spacy train config.cfg --output ./output --paths.train ./training/train.spacy --paths.dev ./training/dev.spacy
```

Latest Training Output:
```bash
ℹ Saving to output directory: output
ℹ Using CPU

=========================== Initializing pipeline ===========================
✔ Initialized pipeline

============================= Training pipeline =============================
ℹ Pipeline: ['tok2vec', 'spancat']
ℹ Initial learn rate: 0.0005
E    #       LOSS TOK2VEC  LOSS SPANCAT  SPANS_SC_F  SPANS_SC_P  SPANS_SC_R  SCORE 
---  ------  ------------  ------------  ----------  ----------  ----------  ------
  0       0         39.84        827.86        0.98        0.50       32.62    0.01
  1     100        140.34       4379.09       18.18       62.50       10.64    0.18
  3     200          4.72       1148.40       46.67       71.01       34.75    0.47
  4     300          4.21        953.41       53.45       68.13       43.97    0.53
  6     400          4.44        843.13       52.53       75.00       40.43    0.53
  7     500          3.92        719.70       60.91       72.55       52.48    0.61
  9     600          3.55        649.99       63.60       69.17       58.87    0.64
 11     700          3.83        486.34       69.11       80.95       60.28    0.69
 12     800          3.52        328.97       71.65       80.53       64.54    0.72
 14     900          3.37        291.17       75.00       73.47       76.60    0.75
 16    1000          3.28        254.67       75.44       75.71       75.18    0.75
 19    1100          2.56        219.40       72.86       73.38       72.34    0.73
 21    1200          2.23        202.14       76.53       77.94       75.18    0.77
 24    1300          2.60        222.31       76.98       82.26       72.34    0.77
 28    1400          2.42        218.73       75.76       81.30       70.92    0.76
 31    1500          2.00        231.73       76.98       82.26       72.34    0.77
 35    1600          1.78        242.98       76.87       81.10       73.05    0.77
 40    1700          1.82        273.90       76.81       82.79       71.63    0.77
 46    1800          1.49        288.22       76.12       80.31       72.34    0.76
 52    1900          1.21        305.64       75.76       81.30       70.92    0.76
 58    2000          1.26        340.43       76.15       83.19       70.21    0.76
 66    2100          1.76        385.03       78.16       85.00       72.34    0.78
 74    2200          1.30        413.31       75.68       83.05       69.50    0.76
 83    2300          1.36        470.41       76.15       83.19       70.21    0.76
 94    2400          1.05        503.36       74.91       79.37       70.92    0.75
105    2500          1.07        533.84       75.86       82.50       70.21    0.76
116    2600          1.15        533.86       73.64       81.20       67.38    0.74
127    2700          0.58        505.34       73.56       80.00       68.09    0.74
138    2800          0.65        528.27       74.80       84.07       67.38    0.75
149    2900          0.69        511.07       74.33       80.83       68.79    0.74
160    3000          0.80        514.51       75.76       81.30       70.92    0.76
171    3100          0.54        506.06       76.05       81.97       70.92    0.76
182    3200          0.65        541.87       75.09       78.91       71.63    0.75
193    3300          0.64        516.70       75.19       82.91       68.79    0.75
204    3400          0.92        514.61       73.48       78.86       68.79    0.73
216    3500          0.79        508.76       72.37       80.17       65.96    0.72
227    3600          0.61        511.00       73.56       80.00       68.09    0.74
238    3700          0.77        496.10       73.96       79.03       69.50    0.74
✔ Saved pipeline to output directory
output/model-last
```

### Evaluation
```bash
python -m spacy evaluate ./output/model-best ./training/test.spacy --output ./metrics.json
```

Latest Evaluation Output:
```bash
ℹ Using CPU

================================== Results ==================================

TOK      100.00
SPAN P   83.03 
SPAN R   59.05 
SPAN F   69.02 
SPEED    31052 


============================== SPANS (per type) ==============================

                            P       R       F
RECEIPT_ITEM_NAME       75.00   66.67   70.59
RECEIPT_ITEM_PRICE      88.37   77.55   82.61
RECEIPT_ITEM            88.46   36.51   51.69
RECEIPT_ITEM_QUANTITY   85.00   59.65   70.10

✔ Saved results to metrics.json
```